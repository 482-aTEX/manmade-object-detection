package com.csce482.atex.testlibspeed;

import android.app.Activity;
import android.hardware.Camera.Size;
import android.os.Bundle;
import android.util.Log;
import android.view.MotionEvent;
import android.view.View;
import android.view.Window;
import android.view.WindowManager;

import java.nio.FloatBuffer;
import java.util.List;

import project.android.imageprocessing.FastImageProcessingPipeline;
import project.android.imageprocessing.FastImageProcessingView;
import project.android.imageprocessing.filter.BasicFilter;
import project.android.imageprocessing.filter.colour.GreyScaleFilter;
import project.android.imageprocessing.filter.processing.ConvolutionFilter;
import project.android.imageprocessing.filter.processing.EnergyFilter;
import com.csce482.atex.testlibspeed.MultiConvolutionFilter;
import project.android.imageprocessing.input.CameraPreviewInput;
import project.android.imageprocessing.input.GLTextureOutputRenderer;
import project.android.imageprocessing.output.ScreenEndpoint;

/**
 * Created by cloudburst on 4/15/15.
 */
public class MainActivity extends Activity {
    private FastImageProcessingView view;
    private GLTextureOutputRenderer input;
    private FastImageProcessingPipeline pipeline;
    private ScreenEndpoint screen;
    private GreyScaleFilter gFilter;
    private MultiConvolutionFilter mcFilter;
    private long touchTime;

    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        requestWindowFeature(Window.FEATURE_NO_TITLE);
        getWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN, WindowManager.LayoutParams.FLAG_FULLSCREEN);
        view = new FastImageProcessingView(this);
        pipeline = new FastImageProcessingPipeline();
        view.setPipeline(pipeline);
        setContentView(view);
        input = new CameraPreviewInput(view);
        gFilter = new GreyScaleFilter();
        int numKernels = 24;
        int kernelSize = 9;
        FloatBuffer kernels = FloatBuffer.allocate(kernelSize*kernelSize*numKernels);
        kernels.put(new float[] {
                6.663195E-5f, -0.0010850301f, 0.007961301f, -0.026321424f, 0.039211895f, -0.026321424f, 0.007961301f, -0.0010850301f, 6.663195E-5f,
                6.70984E-5f, -0.0010926251f, 0.008017029f, -0.02650567f, 0.03948637f, -0.02650567f, 0.008017029f, -0.0010926251f, 6.70984E-5f,
                6.7433524E-5f, -0.0010980826f, 0.008057072f, -0.026638063f, 0.039683603f, -0.026638063f, 0.008057072f, -0.0010980826f, 6.7433524E-5f,
                6.763541E-5f, -0.0011013704f, 0.008081195f, -0.026717816f, 0.039802413f, -0.026717816f, 0.008081195f, -0.0011013704f, 6.763541E-5f,
                6.770285E-5f, -0.0011024683f, 0.008089252f, -0.026744453f, 0.039842095f, -0.026744453f, 0.008089252f, -0.0011024683f, 6.770285E-5f,
                6.763541E-5f, -0.0011013704f, 0.008081195f, -0.026717816f, 0.039802413f, -0.026717816f, 0.008081195f, -0.0011013704f, 6.763541E-5f,
                6.7433524E-5f, -0.0010980826f, 0.008057072f, -0.026638063f, 0.039683603f, -0.026638063f, 0.008057072f, -0.0010980826f, 6.7433524E-5f,
                6.70984E-5f, -0.0010926251f, 0.008017029f, -0.02650567f, 0.03948637f, -0.02650567f, 0.008017029f, -0.0010926251f, 6.70984E-5f,
                6.663195E-5f, -0.0010850301f, 0.007961301f, -0.026321424f, 0.039211895f, -0.026321424f, 0.007961301f, -0.0010850301f, 6.663195E-5f,

                -4.3223366E-8f, -3.7495533E-6f, 1.4574165E-4f, -0.0019424428f, 0.011379268f, -0.030526746f, 0.03599548f, -0.014553802f, -0.0026366399f,
                -3.0551128E-6f, 6.684176E-5f, -6.5608695E-4f, 0.002477622f, -4.221126E-18f, -0.019556198f, 0.040875204f, -0.03286962f, 0.0118583515f,
                2.2660593E-6f, 9.8730074E-5f, -0.001927392f, 0.01290184f, -0.037960738f, 0.051146712f, -0.030290203f, 0.006151027f, 5.596789E-4f,
                1.0719475E-4f, -0.0011779038f, 0.005806856f, -0.011013659f, 3.141381E-18f, 0.0219288f, -0.023020107f, 0.009297348f, -0.001684634f,
                -5.3212465E-5f, -0.0011644084f, 0.011416759f, -0.038383223f, 0.056720678f, -0.038383223f, 0.011416759f, -0.0011644084f, -5.3212465E-5f,
                -0.001684634f, 0.009297348f, -0.023020107f, 0.0219288f, 3.141381E-18f, -0.011013659f, 0.005806856f, -0.0011779038f, 1.0719475E-4f,
                5.596789E-4f, 0.006151027f, -0.030290203f, 0.051146712f, -0.037960738f, 0.01290184f, -0.001927392f, 9.8730074E-5f, 2.2660593E-6f,
                0.0118583515f, -0.03286962f, 0.040875204f, -0.019556198f, -4.221126E-18f, 0.002477622f, -6.5608695E-4f, 6.684176E-5f, -3.0551128E-6f,
                -0.0026366399f, -0.014553802f, 0.03599548f, -0.030526746f, 0.011379268f, -0.0019424428f, 1.4574165E-4f, -3.7495533E-6f, -4.3223366E-8f,

                -4.3223366E-8f, -3.0551128E-6f, 2.2660593E-6f, 1.0719467E-4f, -5.3212098E-5f, -0.0016846335f, 5.596748E-4f, 0.011858346f, -0.0026366124f,
                -3.7495654E-6f, 6.6841625E-5f, 9.873023E-5f, -0.001177903f, -0.0011644107f, 0.009297342f, 0.0061510396f, -0.032869592f, -0.014553851f,
                1.4574165E-4f, -6.5608695E-4f, -0.001927392f, 0.005806856f, 0.011416763f, -0.023020098f, -0.030290216f, 0.040875178f, 0.035995517f,
                -0.0019424428f, 0.002477622f, 0.01290184f, -0.011013659f, -0.038383227f, 0.021928785f, 0.05114672f, -0.019556174f, -0.03052676f,
                0.01137927f, -8.6057E-9f, -0.03796074f, 4.8033E-9f, 0.056720678f, 4.8033E-9f, -0.03796074f, -8.6057E-9f, 0.01137927f,
                -0.03052676f, -0.019556174f, 0.05114672f, 0.021928785f, -0.038383227f, -0.011013659f, 0.01290184f, 0.002477622f, -0.0019424428f,
                0.035995517f, 0.040875178f, -0.030290216f, -0.023020098f, 0.011416763f, 0.005806856f, -0.001927392f, -6.5608695E-4f, 1.4574165E-4f,
                -0.014553851f, -0.032869592f, 0.0061510396f, 0.009297342f, -0.0011644107f, -0.001177903f, 9.873023E-5f, 6.6841625E-5f, -3.7495654E-6f,
                -0.0026366124f, 0.011858346f, 5.596748E-4f, -0.0016846335f, -5.3212098E-5f, 1.0719467E-4f, 2.2660593E-6f, -3.0551128E-6f, -4.3223366E-8f,

                6.6631976E-5f, 6.709843E-5f, 6.74335E-5f, 6.763538E-5f, 6.770283E-5f, 6.763538E-5f, 6.74335E-5f, 6.709838E-5f, 6.6631925E-5f,
                -0.0010850301f, -0.0010926252f, -0.0010980822f, -0.0011013701f, -0.0011024679f, -0.0011013701f, -0.0010980822f, -0.0010926239f, -0.0010850289f,
                0.007961299f, 0.008017028f, 0.008057071f, 0.008081192f, 0.008089249f, 0.008081192f, 0.008057069f, 0.008017022f, 0.007961295f,
                -0.02632142f, -0.026505662f, -0.026638055f, -0.026717808f, -0.026744442f, -0.026717804f, -0.02663805f, -0.026505657f, -0.026321413f,
                0.03921188f, 0.039486356f, 0.039683588f, 0.0398024f, 0.03984208f, 0.0398024f, 0.039683588f, 0.039486356f, 0.03921188f,
                -0.026321413f, -0.026505657f, -0.02663805f, -0.026717804f, -0.026744442f, -0.026717808f, -0.026638055f, -0.026505662f, -0.02632142f,
                0.007961295f, 0.008017022f, 0.008057069f, 0.008081192f, 0.008089249f, 0.008081192f, 0.008057071f, 0.008017028f, 0.007961299f,
                -0.0010850289f, -0.0010926239f, -0.0010980822f, -0.0011013701f, -0.0011024679f, -0.0011013701f, -0.0010980822f, -0.0010926252f, -0.0010850301f,
                6.6631925E-5f, 6.709838E-5f, 6.74335E-5f, 6.763538E-5f, 6.770283E-5f, 6.763538E-5f, 6.74335E-5f, 6.709843E-5f, 6.6631976E-5f,

                -0.0026366583f, 0.011858354f, 5.5968284E-4f, -0.001684634f, -5.3212465E-5f, 1.0719475E-4f, 2.2660593E-6f, -3.0551128E-6f, -4.3223366E-8f,
                -0.0145537695f, -0.03286963f, 0.006151021f, 0.009297348f, -0.0011644084f, -0.0011779038f, 9.873023E-5f, 6.6841625E-5f, -3.7495654E-6f,
                0.03599545f, 0.04087523f, -0.03029019f, -0.023020117f, 0.011416759f, 0.005806856f, -0.001927392f, -6.5608695E-4f, 1.4574165E-4f,
                -0.03052673f, -0.019556226f, 0.051146705f, 0.02192881f, -0.038383223f, -0.011013659f, 0.01290184f, 0.002477616f, -0.001942442f,
                0.011379263f, 1.7211393E-8f, -0.037960734f, -9.6066E-9f, 0.056720678f, -9.6066E-9f, -0.037960734f, 1.7211393E-8f, 0.011379263f,
                -0.001942442f, 0.002477616f, 0.01290184f, -0.011013659f, -0.038383223f, 0.02192881f, 0.051146705f, -0.019556226f, -0.03052673f,
                1.4574165E-4f, -6.5608695E-4f, -0.001927392f, 0.005806856f, 0.011416759f, -0.023020117f, -0.03029019f, 0.04087523f, 0.03599545f,
                -3.7495654E-6f, 6.6841625E-5f, 9.873023E-5f, -0.0011779038f, -0.0011644084f, 0.009297348f, 0.006151021f, -0.03286963f, -0.0145537695f,
                -4.3223366E-8f, -3.0551128E-6f, 2.2660593E-6f, 1.0719475E-4f, -5.3212465E-5f, -0.001684634f, 5.5968284E-4f, 0.011858354f, -0.0026366583f,

                -0.0026365493f, -0.014553968f, 0.035995614f, -0.0305268f, 0.011379282f, -0.0019424441f, 1.457416E-4f, -3.7495538E-6f, -4.322404E-8f,
                0.011858338f, -0.032869563f, 0.04087512f, -0.019556124f, -3.4422822E-8f, 0.0024776326f, -6.5608864E-4f, 6.684177E-5f, -3.055113E-6f,
                5.5966707E-4f, 0.0061510717f, -0.03029026f, 0.051146757f, -0.037960753f, 0.012901841f, -0.0019273915f, 9.873024E-5f, 2.2660595E-6f,
                -0.001684632f, 0.00929733f, -0.023020081f, 0.021928754f, 2.8819803E-8f, -0.011013671f, 0.0058068563f, -0.0011779033f, 1.0719468E-4f,
                -5.321171E-5f, -0.0011644129f, 0.011416767f, -0.03838323f, 0.056720685f, -0.03838323f, 0.011416767f, -0.0011644129f, -5.321171E-5f,
                1.0719468E-4f, -0.0011779033f, 0.0058068563f, -0.011013671f, 2.8819803E-8f, 0.021928754f, -0.023020081f, 0.00929733f, -0.001684632f,
                2.2660595E-6f, 9.873024E-5f, -0.0019273915f, 0.012901841f, -0.037960753f, 0.051146757f, -0.03029026f, 0.0061510717f, 5.5966707E-4f,
                -3.055113E-6f, 6.684177E-5f, -6.5608864E-4f, 0.0024776326f, -3.4422822E-8f, -0.019556124f, 0.04087512f, -0.032869563f, 0.011858338f,
                -4.322404E-8f, -3.7495538E-6f, 1.457416E-4f, -0.0019424441f, 0.011379282f, -0.0305268f, 0.035995614f, -0.014553968f, -0.0026365493f,

                6.4782056E-5f, -0.0010549063f, 0.0077402703f, -0.025590658f, 0.03812325f, -0.025590658f, 0.0077402703f, -0.0010549063f, 6.4782056E-5f,
                6.661504E-5f, -0.0010847545f, 0.007959278f, -0.02631474f, 0.039201934f, -0.02631474f, 0.007959278f, -0.0010847545f, 6.661504E-5f,
                6.795597E-5f, -0.0011065904f, 0.008119497f, -0.026844447f, 0.039991062f, -0.026844447f, 0.008119497f, -0.0011065904f, 6.795597E-5f,
                6.877347E-5f, -0.0011199021f, 0.008217171f, -0.027167378f, 0.040472142f, -0.027167378f, 0.008217171f, -0.0011199021f, 6.877347E-5f,
                6.9048154E-5f, -0.001124375f, 0.008249991f, -0.027275883f, 0.040633783f, -0.027275883f, 0.008249991f, -0.001124375f, 6.9048154E-5f,
                6.877347E-5f, -0.0011199021f, 0.008217171f, -0.027167378f, 0.040472142f, -0.027167378f, 0.008217171f, -0.0011199021f, 6.877347E-5f,
                6.795597E-5f, -0.0011065904f, 0.008119497f, -0.026844447f, 0.039991062f, -0.026844447f, 0.008119497f, -0.0011065904f, 6.795597E-5f,
                6.661504E-5f, -0.0010847545f, 0.007959278f, -0.02631474f, 0.039201934f, -0.02631474f, 0.007959278f, -0.0010847545f, 6.661504E-5f,
                6.4782056E-5f, -0.0010549063f, 0.0077402703f, -0.025590658f, 0.03812325f, -0.025590658f, 0.0077402703f, -0.0010549063f, 6.4782056E-5f,

                -4.403439E-8f, -3.8003843E-6f, 1.4674292E-4f, -0.0019399828f, 0.011256182f, -0.029863117f, 0.03477214f, -0.013862435f, -0.0024725455f,
                -3.1291002E-6f, 6.82871E-5f, -6.675783E-4f, 0.0025071276f, -4.241516E-18f, -0.019484064f, 0.040318858f, -0.032051396f, 0.01141383f,
                2.322922E-6f, 1.0121291E-4f, -0.0019730164f, 0.0131685315f, -0.038574133f, 0.05166613f, -0.030371616f, 0.006112822f, 5.504428E-4f,
                1.0948647E-4f, -0.0012062702f, 0.0059535257f, -0.011287925f, 3.213685E-18f, 0.022358807f, -0.023358395f, 0.009374487f, -0.0016853792f,
                -5.3910906E-5f, -0.0011858795f, 0.011670809f, -0.039325416f, 0.05815645f, -0.039325416f, 0.011670809f, -0.0011858795f, -5.3910906E-5f,
                -0.0016853792f, 0.009374487f, -0.023358395f, 0.022358807f, 3.213685E-18f, -0.011287925f, 0.0059535257f, -0.0012062702f, 1.0948647E-4f,
                5.504428E-4f, 0.006112822f, -0.030371616f, 0.05166613f, -0.038574133f, 0.0131685315f, -0.0019730164f, 1.0121291E-4f, 2.322922E-6f,
                0.01141383f, -0.032051396f, 0.040318858f, -0.019484064f, -4.241516E-18f, 0.0025071276f, -6.675783E-4f, 6.82871E-5f, -3.1291002E-6f,
                -0.0024725455f, -0.013862435f, 0.03477214f, -0.029863117f, 0.011256182f, -0.0019399828f, 1.4674292E-4f, -3.8003843E-6f, -4.403439E-8f,

                -4.4034394E-8f, -3.1291004E-6f, 2.3229222E-6f, 1.094864E-4f, -5.391054E-5f, -0.0016853788f, 5.504389E-4f, 0.011413826f, -0.00247252f,
                -3.8003966E-6f, 6.828698E-5f, 1.0121308E-4f, -0.0012062695f, -0.0011858819f, 0.009374482f, 0.0061128354f, -0.032051373f, -0.013862483f,
                1.4674294E-4f, -6.6757837E-4f, -0.0019730167f, 0.005953526f, 0.011670815f, -0.023358388f, -0.030371636f, 0.040318836f, 0.034772173f,
                -0.001939983f, 0.0025071278f, 0.013168533f, -0.011287927f, -0.039325424f, 0.022358794f, 0.051666144f, -0.019484043f, -0.029863134f,
                0.011256184f, -8.647272E-9f, -0.03857414f, 4.9138564E-9f, 0.058156453f, 4.9138564E-9f, -0.03857414f, -8.647272E-9f, 0.011256184f,
                -0.029863134f, -0.019484043f, 0.051666144f, 0.022358794f, -0.039325424f, -0.011287927f, 0.013168533f, 0.0025071278f, -0.001939983f,
                0.034772173f, 0.040318836f, -0.030371636f, -0.023358388f, 0.011670815f, 0.005953526f, -0.0019730167f, -6.6757837E-4f, 1.4674294E-4f,
                -0.013862483f, -0.032051373f, 0.0061128354f, 0.009374482f, -0.0011858819f, -0.0012062695f, 1.0121308E-4f, 6.828698E-5f, -3.8003966E-6f,
                -0.00247252f, 0.011413826f, 5.504389E-4f, -0.0016853788f, -5.391054E-5f, 1.094864E-4f, 2.3229222E-6f, -3.1291004E-6f, -4.4034394E-8f,

                6.47821E-5f, 6.661508E-5f, 6.795596E-5f, 6.8773465E-5f, 6.904815E-5f, 6.8773465E-5f, 6.795596E-5f, 6.661504E-5f, 6.4782056E-5f,
                -0.0010549066f, -0.0010847547f, -0.0011065903f, -0.0011199021f, -0.001124375f, -0.0011199021f, -0.0011065903f, -0.0010847535f, -0.0010549054f,
                0.0077402717f, 0.007959279f, 0.008119498f, 0.008217171f, 0.00824999f, 0.008217171f, 0.0081194965f, 0.007959275f, 0.0077402666f,
                -0.025590662f, -0.02631474f, -0.02684445f, -0.027167378f, -0.02727588f, -0.027167376f, -0.026844444f, -0.026314734f, -0.025590654f,
                0.038123246f, 0.03920193f, 0.03999106f, 0.04047214f, 0.04063378f, 0.04047214f, 0.03999106f, 0.03920193f, 0.038123246f,
                -0.025590654f, -0.026314734f, -0.026844444f, -0.027167376f, -0.02727588f, -0.027167378f, -0.02684445f, -0.02631474f, -0.025590662f,
                0.0077402666f, 0.007959275f, 0.0081194965f, 0.008217171f, 0.00824999f, 0.008217171f, 0.008119498f, 0.007959279f, 0.0077402717f,
                -0.0010549054f, -0.0010847535f, -0.0011065903f, -0.0011199021f, -0.001124375f, -0.0011199021f, -0.0011065903f, -0.0010847547f, -0.0010549066f,
                6.4782056E-5f, 6.661504E-5f, 6.795596E-5f, 6.8773465E-5f, 6.904815E-5f, 6.8773465E-5f, 6.795596E-5f, 6.661508E-5f, 6.47821E-5f,

                -0.0024725627f, 0.011413833f, 5.504466E-4f, -0.0016853792f, -5.3910906E-5f, 1.0948647E-4f, 2.322922E-6f, -3.1291002E-6f, -4.403439E-8f,
                -0.013862402f, -0.03205141f, 0.006112816f, 0.009374487f, -0.0011858795f, -0.0012062702f, 1.01213074E-4f, 6.8286965E-5f, -3.8003964E-6f,
                0.034772106f, 0.040318884f, -0.030371604f, -0.023358406f, 0.011670809f, 0.0059535257f, -0.0019730164f, -6.675783E-4f, 1.4674292E-4f,
                -0.029863106f, -0.019484093f, 0.051666122f, 0.022358818f, -0.039325416f, -0.011287925f, 0.0131685315f, 0.0025071218f, -0.001939982f,
                0.011256177f, 1.7294536E-8f, -0.03857413f, -9.827712E-9f, 0.05815645f, -9.827712E-9f, -0.03857413f, 1.7294536E-8f, 0.011256177f,
                -0.001939982f, 0.0025071218f, 0.0131685315f, -0.011287925f, -0.039325416f, 0.022358818f, 0.051666122f, -0.019484093f, -0.029863106f,
                1.4674292E-4f, -6.675783E-4f, -0.0019730164f, 0.0059535257f, 0.011670809f, -0.023358406f, -0.030371604f, 0.040318884f, 0.034772106f,
                -3.8003964E-6f, 6.8286965E-5f, 1.01213074E-4f, -0.0012062702f, -0.0011858795f, 0.009374487f, 0.006112816f, -0.03205141f, -0.013862402f,
                -4.403439E-8f, -3.1291002E-6f, 2.322922E-6f, 1.0948647E-4f, -5.3910906E-5f, -0.0016853792f, 5.504466E-4f, 0.011413833f, -0.0024725627f,

                -0.0024724593f, -0.013862584f, 0.034772247f, -0.029863155f, 0.011256189f, -0.001939983f, 1.4674276E-4f, -3.8003827E-6f, -4.403505E-8f,
                0.011413811f, -0.03205132f, 0.040318757f, -0.01948398f, -3.4589082E-8f, 0.0025071371f, -6.6757965E-4f, 6.8287074E-5f, -3.1290988E-6f,
                5.504309E-4f, 0.0061128633f, -0.030371659f, 0.051666144f, -0.03857413f, 0.013168526f, -0.001973015f, 1.0121302E-4f, 2.322921E-6f,
                -0.0016853763f, 0.009374464f, -0.023358356f, 0.022358749f, 2.9483123E-8f, -0.011287931f, 0.005953523f, -0.0012062689f, 1.0948634E-4f,
                -5.391011E-5f, -0.0011858834f, 0.011670811f, -0.0393254f, 0.058156423f, -0.0393254f, 0.011670811f, -0.0011858834f, -5.391011E-5f,
                1.0948634E-4f, -0.0012062689f, 0.005953523f, -0.011287931f, 2.9483123E-8f, 0.022358749f, -0.023358356f, 0.009374464f, -0.0016853763f,
                2.322921E-6f, 1.0121302E-4f, -0.001973015f, 0.013168526f, -0.03857413f, 0.051666144f, -0.030371659f, 0.0061128633f, 5.504309E-4f,
                -3.1290988E-6f, 6.8287074E-5f, -6.6757965E-4f, 0.0025071371f, -3.4589082E-8f, -0.01948398f, 0.040318757f, -0.03205132f, 0.011413811f,
                -4.403505E-8f, -3.8003827E-6f, 1.4674276E-4f, -0.001939983f, 0.011256189f, -0.029863155f, 0.034772247f, -0.013862584f, -0.0024724593f,

                5.7709272E-5f, -9.3973323E-4f, 0.0068952003f, -0.022796711f, 0.033961017f, -0.022796711f, 0.0068952003f, -9.3973323E-4f, 5.7709272E-5f,
                6.452318E-5f, -0.001050691f, 0.00770934f, -0.0254884f, 0.03797091f, -0.0254884f, 0.00770934f, -0.001050691f, 6.452318E-5f,
                6.987753E-5f, -0.0011378806f, 0.008349086f, -0.027603509f, 0.04112186f, -0.027603509f, 0.008349086f, -0.0011378806f, 6.987753E-5f,
                7.330108E-5f, -0.0011936299f, 0.008758141f, -0.028955916f, 0.04313658f, -0.028955916f, 0.008758141f, -0.0011936299f, 7.330108E-5f,
                7.4479176E-5f, -0.0012128135f, 0.008898899f, -0.029421283f, 0.04382986f, -0.029421283f, 0.008898899f, -0.0012128135f, 7.4479176E-5f,
                7.330108E-5f, -0.0011936299f, 0.008758141f, -0.028955916f, 0.04313658f, -0.028955916f, 0.008758141f, -0.0011936299f, 7.330108E-5f,
                6.987753E-5f, -0.0011378806f, 0.008349086f, -0.027603509f, 0.04112186f, -0.027603509f, 0.008349086f, -0.0011378806f, 6.987753E-5f,
                6.452318E-5f, -0.001050691f, 0.00770934f, -0.0254884f, 0.03797091f, -0.0254884f, 0.00770934f, -0.001050691f, 6.452318E-5f,
                5.7709272E-5f, -9.3973323E-4f, 0.0068952003f, -0.022796711f, 0.033961017f, -0.022796711f, 0.0068952003f, -9.3973323E-4f, 5.7709272E-5f,

                -4.720886E-8f, -3.99169E-6f, 1.5010257E-4f, -0.0019210296f, 0.010725944f, -0.0272202f, 0.030137183f, -0.0113561f, -0.0019030751f,
                -3.4270888E-6f, 7.403555E-5f, -7.122016E-4f, 0.0026162523f, -4.303583E-18f, -0.019107234f, 0.037987355f, -0.028839901f, 0.009749842f,
                2.5528482E-6f, 1.1125505E-4f, -0.0021563102f, 0.014223868f, -0.040933594f, 0.053542223f, -0.030554023f, 0.0059341113f, 5.125581E-4f,
                1.1858946E-4f, -0.0013204463f, 0.0065470315f, -0.012396008f, 3.503256E-18f, 0.02405035f, -0.02464469f, 0.00964359f, -0.0016803636f,
                -5.652846E-5f, -0.0012697529f, 0.012684438f, -0.043125935f, 0.063967794f, -0.043125935f, 0.012684438f, -0.0012697529f, -5.652846E-5f,
                -0.0016803636f, 0.00964359f, -0.02464469f, 0.02405035f, 3.503256E-18f, -0.012396008f, 0.0065470315f, -0.0013204463f, 1.1858946E-4f,
                5.125581E-4f, 0.0059341113f, -0.030554023f, 0.053542223f, -0.040933594f, 0.014223868f, -0.0021563102f, 1.1125505E-4f, 2.5528482E-6f,
                0.009749842f, -0.028839901f, 0.037987355f, -0.019107234f, -4.303583E-18f, 0.0026162523f, -7.122016E-4f, 7.403555E-5f, -3.4270888E-6f,
                -0.0019030751f, -0.0113561f, 0.030137183f, -0.0272202f, 0.010725944f, -0.0019210296f, 1.5010257E-4f, -3.99169E-6f, -4.720886E-8f,

                -4.7208847E-8f, -3.4270877E-6f, 2.5528475E-6f, 1.1858933E-4f, -5.652805E-5f, -0.0016803625f, 5.125541E-4f, 0.0097498335f, -0.0019030545f,
                -3.9917013E-6f, 7.4035386E-5f, 1.1125519E-4f, -0.0013204449f, -0.001269755f, 0.009643581f, 0.005934122f, -0.028839871f, -0.011356135f,
                1.5010253E-4f, -7.122014E-4f, -0.0021563096f, 0.0065470296f, 0.012684439f, -0.024644671f, -0.030554028f, 0.037987318f, 0.030137202f,
                -0.0019210291f, 0.0026162514f, 0.014223863f, -0.012396004f, -0.04312592f, 0.024050327f, 0.053542208f, -0.019107206f, -0.027220204f,
                0.010725942f, -8.773806E-9f, -0.040933587f, 5.3566205E-9f, 0.06396777f, 5.3566205E-9f, -0.040933587f, -8.773806E-9f, 0.010725942f,
                -0.027220204f, -0.019107206f, 0.053542208f, 0.024050327f, -0.04312592f, -0.012396004f, 0.014223863f, 0.0026162514f, -0.0019210291f,
                0.030137202f, 0.037987318f, -0.030554028f, -0.024644671f, 0.012684439f, 0.0065470296f, -0.0021563096f, -7.122014E-4f, 1.5010253E-4f,
                -0.011356135f, -0.028839871f, 0.005934122f, 0.009643581f, -0.001269755f, -0.0013204449f, 1.1125519E-4f, 7.4035386E-5f, -3.9917013E-6f,
                -0.0019030545f, 0.0097498335f, 5.125541E-4f, -0.0016803625f, -5.652805E-5f, 1.1858933E-4f, 2.5528475E-6f, -3.4270877E-6f, -4.7208847E-8f,

                5.77093E-5f, 6.4523214E-5f, 6.987752E-5f, 7.3301075E-5f, 7.447917E-5f, 7.3301075E-5f, 6.987752E-5f, 6.452316E-5f, 5.770926E-5f,
                -9.397334E-4f, -0.0010506912f, -0.0011378805f, -0.0011936297f, -0.0012128133f, -0.0011936297f, -0.0011378805f, -0.0010506902f, -9.397323E-4f,
                0.0068952003f, 0.00770934f, 0.008349087f, 0.00875814f, 0.008898897f, 0.00875814f, 0.008349085f, 0.007709336f, 0.0068951966f,
                -0.022796713f, -0.025488399f, -0.027603507f, -0.028955912f, -0.02942128f, -0.02895591f, -0.027603501f, -0.025488393f, -0.022796705f,
                0.03396101f, 0.037970904f, 0.04112185f, 0.043136574f, 0.04382985f, 0.043136574f, 0.04112185f, 0.037970904f, 0.03396101f,
                -0.022796705f, -0.025488393f, -0.027603501f, -0.02895591f, -0.02942128f, -0.028955912f, -0.027603507f, -0.025488399f, -0.022796713f,
                0.0068951966f, 0.007709336f, 0.008349085f, 0.00875814f, 0.008898897f, 0.00875814f, 0.008349087f, 0.00770934f, 0.0068952003f,
                -9.397323E-4f, -0.0010506902f, -0.0011378805f, -0.0011936297f, -0.0012128133f, -0.0011936297f, -0.0011378805f, -0.0010506912f, -9.397334E-4f,
                5.770926E-5f, 6.452316E-5f, 6.987752E-5f, 7.3301075E-5f, 7.447917E-5f, 7.3301075E-5f, 6.987752E-5f, 6.4523214E-5f, 5.77093E-5f,

                -0.001903088f, 0.009749843f, 5.125616E-4f, -0.0016803633f, -5.6528454E-5f, 1.1858939E-4f, 2.552848E-6f, -3.4270884E-6f, -4.7208854E-8f,
                -0.011356073f, -0.028839907f, 0.005934105f, 0.009643588f, -0.0012697527f, -0.0013204461f, 1.1125521E-4f, 7.403539E-5f, -3.991702E-6f,
                0.030137151f, 0.037987377f, -0.030554008f, -0.024644697f, 0.0126844365f, 0.0065470305f, -0.00215631f, -7.122015E-4f, 1.5010255E-4f,
                -0.027220184f, -0.01910726f, 0.0535422f, 0.024050357f, -0.04312593f, -0.012396007f, 0.014223866f, 0.0026162462f, -0.0019210285f,
                0.010725938f, 1.7547606E-8f, -0.040933587f, -1.0713243E-8f, 0.06396779f, -1.0713243E-8f, -0.040933587f, 1.7547606E-8f, 0.010725938f,
                -0.0019210285f, 0.0026162462f, 0.014223866f, -0.012396007f, -0.04312593f, 0.024050357f, 0.0535422f, -0.01910726f, -0.027220184f,
                1.5010255E-4f, -7.122015E-4f, -0.00215631f, 0.0065470305f, 0.0126844365f, -0.024644697f, -0.030554008f, 0.037987377f, 0.030137151f,
                -3.991702E-6f, 7.403539E-5f, 1.1125521E-4f, -0.0013204461f, -0.0012697527f, 0.009643588f, 0.005934105f, -0.028839907f, -0.011356073f,
                -4.7208854E-8f, -3.4270884E-6f, 2.552848E-6f, 1.1858939E-4f, -5.6528454E-5f, -0.0016803633f, 5.125616E-4f, 0.009749843f, -0.001903088f,

                -0.0019030084f, -0.011356222f, 0.030137274f, -0.027220232f, 0.010725951f, -0.0019210295f, 1.5010241E-4f, -3.9916877E-6f, -4.7209568E-8f,
                0.009749823f, -0.028839832f, 0.037987255f, -0.019107146f, -3.5095226E-8f, 0.002616262f, -7.12203E-4f, 7.403552E-5f, -3.427087E-6f,
                5.125469E-4f, 0.0059341514f, -0.030554062f, 0.053542227f, -0.040933583f, 0.014223861f, -0.0021563084f, 1.1125517E-4f, 2.5528468E-6f,
                -0.0016803605f, 0.009643565f, -0.024644643f, 0.024050284f, 3.2139717E-8f, -0.012396013f, 0.0065470277f, -0.0013204446f, 1.185893E-4f,
                -5.652762E-5f, -0.0012697569f, 0.012684438f, -0.043125916f, 0.06396776f, -0.043125916f, 0.012684438f, -0.0012697569f, -5.652762E-5f,
                1.185893E-4f, -0.0013204446f, 0.0065470277f, -0.012396013f, 3.2139717E-8f, 0.024050284f, -0.024644643f, 0.009643565f, -0.0016803605f,
                2.5528468E-6f, 1.1125517E-4f, -0.0021563084f, 0.014223861f, -0.040933583f, 0.053542227f, -0.030554062f, 0.0059341514f, 5.125469E-4f,
                -3.427087E-6f, 7.403552E-5f, -7.12203E-4f, 0.002616262f, -3.5095226E-8f, -0.019107146f, 0.037987255f, -0.028839832f, 0.009749823f,
                -4.7209568E-8f, -3.9916877E-6f, 1.5010241E-4f, -0.0019210295f, 0.010725951f, -0.027220232f, 0.030137274f, -0.011356222f, -0.0019030084f,

                3.4777622E-5f, -5.6631607E-4f, 0.004155288f, -0.013738096f, 0.020466095f, -0.013738096f, 0.004155288f, -5.6631607E-4f, 3.4777622E-5f,
                5.4347704E-5f, -8.8499405E-4f, 0.0064935577f, -0.021468813f, 0.031982798f, -0.021468813f, 0.0064935577f, -8.8499405E-4f, 5.4347704E-5f,
                7.47598E-5f, -0.0012173827f, 0.008932427f, -0.02953213f, 0.043994993f, -0.02953213f, 0.008932427f, -0.0012173827f, 7.47598E-5f,
                9.052325E-5f, -0.001474074f, 0.010815872f, -0.03575912f, 0.053271547f, -0.03575912f, 0.010815872f, -0.001474074f, 9.052325E-5f,
                9.648448E-5f, -0.0015711462f, 0.01152813f, -0.03811397f, 0.05677964f, -0.03811397f, 0.01152813f, -0.0015711462f, 9.648448E-5f,
                9.052325E-5f, -0.001474074f, 0.010815872f, -0.03575912f, 0.053271547f, -0.03575912f, 0.010815872f, -0.001474074f, 9.052325E-5f,
                7.47598E-5f, -0.0012173827f, 0.008932427f, -0.02953213f, 0.043994993f, -0.02953213f, 0.008932427f, -0.0012173827f, 7.47598E-5f,
                5.4347704E-5f, -8.8499405E-4f, 0.0064935577f, -0.021468813f, 0.031982798f, -0.021468813f, 0.0064935577f, -8.8499405E-4f, 5.4347704E-5f,
                3.4777622E-5f, -5.6631607E-4f, 0.004155288f, -0.013738096f, 0.020466095f, -0.013738096f, 0.004155288f, -5.6631607E-4f, 3.4777622E-5f,

                -5.828985E-8f, -4.540665E-6f, 1.5358801E-4f, -0.0017263268f, 0.008265287f, -0.017561462f, 0.015893968f, -0.004780054f, -6.2423316E-4f,
                -4.6088576E-6f, 9.5607415E-5f, -8.622843E-4f, 0.002899592f, -4.2629564E-18f, -0.0165164f, 0.027977379f, -0.017669553f, 0.004851844f,
                3.480424E-6f, 1.5180981E-4f, -0.0028752626f, 0.018096056f, -0.048513144f, 0.057716865f, -0.029249271f, 0.004925566f, 3.601727E-4f,
                1.5255714E-4f, -0.001772026f, 0.00894891f, -0.016849902f, 4.623711E-18f, 0.030092413f, -0.028542317f, 0.010093653f, -0.0015519225f,
                -6.3866566E-5f, -0.0015598345f, 0.016542332f, -0.058296677f, 0.08751045f, -0.058296677f, 0.016542332f, -0.0015598345f, -6.3866566E-5f,
                -0.0015519225f, 0.010093653f, -0.028542317f, 0.030092413f, 4.623711E-18f, -0.016849902f, 0.00894891f, -0.001772026f, 1.5255714E-4f,
                3.601727E-4f, 0.004925566f, -0.029249271f, 0.057716865f, -0.048513144f, 0.018096056f, -0.0028752626f, 1.5180981E-4f, 3.480424E-6f,
                0.004851844f, -0.017669553f, 0.027977379f, -0.0165164f, -4.2629564E-18f, 0.002899592f, -8.622843E-4f, 9.5607415E-5f, -4.6088576E-6f,
                -6.2423316E-4f, -0.004780054f, 0.015893968f, -0.017561462f, 0.008265287f, -0.0017263268f, 1.5358801E-4f, -4.540665E-6f, -5.828985E-8f,

                -5.8289853E-8f, -4.608858E-6f, 3.4804243E-6f, 1.5255706E-4f, -6.386613E-5f, -0.0015519222f, 3.601702E-4f, 0.0048518414f, -6.242268E-4f,
                -4.54068E-6f, 9.560723E-5f, 1.5181006E-4f, -0.0017720249f, -0.0015598376f, 0.010093648f, 0.004925577f, -0.01766954f, -0.004780071f,
                1.5358797E-4f, -8.62284E-4f, -0.0028752629f, 0.008948911f, 0.01654234f, -0.028542306f, -0.029249292f, 0.027977359f, 0.015893985f,
                -0.001726327f, 0.0028995923f, 0.018096056f, -0.016849903f, -0.058296688f, 0.030092394f, 0.057716873f, -0.016516382f, -0.017561467f,
                0.008265288f, -8.690981E-9f, -0.048513148f, 7.0698443E-9f, 0.08751046f, 7.0698443E-9f, -0.048513148f, -8.690981E-9f, 0.008265288f,
                -0.017561467f, -0.016516382f, 0.057716873f, 0.030092394f, -0.058296688f, -0.016849903f, 0.018096056f, 0.0028995923f, -0.001726327f,
                0.015893985f, 0.027977359f, -0.029249292f, -0.028542306f, 0.01654234f, 0.008948911f, -0.0028752629f, -8.62284E-4f, 1.5358797E-4f,
                -0.004780071f, -0.01766954f, 0.004925577f, 0.010093648f, -0.0015598376f, -0.0017720249f, 1.5181006E-4f, 9.560723E-5f, -4.54068E-6f,
                -6.242268E-4f, 0.0048518414f, 3.601702E-4f, -0.0015519222f, -6.386613E-5f, 1.5255706E-4f, 3.4804243E-6f, -4.608858E-6f, -5.8289853E-8f,

                3.4777648E-5f, 5.434774E-5f, 7.4759795E-5f, 9.052324E-5f, 9.6484466E-5f, 9.052324E-5f, 7.4759795E-5f, 5.4347696E-5f, 3.477762E-5f,
                -5.6631624E-4f, -8.849943E-4f, -0.0012173826f, -0.0014740739f, -0.0015711461f, -0.0014740739f, -0.0012173826f, -8.8499364E-4f, -5.6631584E-4f,
                0.0041552894f, 0.0064935577f, 0.0089324275f, 0.01081587f, 0.011528128f, 0.01081587f, 0.008932426f, 0.0064935545f, 0.004155286f,
                -0.013738096f, -0.021468813f, -0.02953213f, -0.03575912f, -0.038113967f, -0.035759117f, -0.029532123f, -0.021468809f, -0.013738093f,
                0.020466093f, 0.031982794f, 0.04399499f, 0.05327154f, 0.056779638f, 0.05327154f, 0.04399499f, 0.031982794f, 0.020466093f,
                -0.013738093f, -0.021468809f, -0.029532123f, -0.035759117f, -0.038113967f, -0.03575912f, -0.02953213f, -0.021468813f, -0.013738096f,
                0.004155286f, 0.0064935545f, 0.008932426f, 0.01081587f, 0.011528128f, 0.01081587f, 0.0089324275f, 0.0064935577f, 0.0041552894f,
                -5.6631584E-4f, -8.8499364E-4f, -0.0012173826f, -0.0014740739f, -0.0015711461f, -0.0014740739f, -0.0012173826f, -8.849943E-4f, -5.6631624E-4f,
                3.477762E-5f, 5.4347696E-5f, 7.4759795E-5f, 9.052324E-5f, 9.6484466E-5f, 9.052324E-5f, 7.4759795E-5f, 5.434774E-5f, 3.4777648E-5f,

                -6.242375E-4f, 0.0048518437f, 3.6017524E-4f, -0.0015519225f, -6.3866566E-5f, 1.5255714E-4f, 3.480424E-6f, -4.6088576E-6f, -5.828985E-8f,
                -0.0047800434f, -0.017669559f, 0.004925562f, 0.010093653f, -0.0015598345f, -0.001772026f, 1.5181006E-4f, 9.5607225E-5f, -4.5406796E-6f,
                0.015893955f, 0.027977396f, -0.029249262f, -0.02854233f, 0.016542332f, 0.00894891f, -0.0028752626f, -8.622843E-4f, 1.5358801E-4f,
                -0.017561452f, -0.016516425f, 0.057716854f, 0.030092426f, -0.058296677f, -0.016849902f, 0.018096056f, 0.002899586f, -0.001726326f,
                0.008265283f, 1.7381955E-8f, -0.048513137f, -1.4139688E-8f, 0.08751045f, -1.4139688E-8f, -0.048513137f, 1.7381955E-8f, 0.008265283f,
                -0.001726326f, 0.002899586f, 0.018096056f, -0.016849902f, -0.058296677f, 0.030092426f, 0.057716854f, -0.016516425f, -0.017561452f,
                1.5358801E-4f, -8.622843E-4f, -0.0028752626f, 0.00894891f, 0.016542332f, -0.02854233f, -0.029249262f, 0.027977396f, 0.015893955f,
                -4.5406796E-6f, 9.5607225E-5f, 1.5181006E-4f, -0.001772026f, -0.0015598345f, 0.010093653f, 0.004925562f, -0.017669559f, -0.0047800434f,
                -5.828985E-8f, -4.6088576E-6f, 3.480424E-6f, 1.5255714E-4f, -6.3866566E-5f, -0.0015519225f, 3.6017524E-4f, 0.0048518437f, -6.242375E-4f,

                -6.242116E-4f, -0.0047801067f, 0.01589402f, -0.017561484f, 0.008265292f, -0.0017263265f, 1.5358784E-4f, -4.540664E-6f, -5.8290738E-8f,
                0.0048518367f, -0.01766952f, 0.02797731f, -0.01651633f, -3.4763932E-8f, 0.0028996035f, -8.622859E-4f, 9.560732E-5f, -4.608856E-6f,
                3.6016508E-4f, 0.0049256017f, -0.02924932f, 0.05771689f, -0.048513148f, 0.018096048f, -0.002875261f, 1.5181002E-4f, 3.4804232E-6f,
                -0.0015519208f, 0.010093632f, -0.028542273f, 0.03009234f, 4.241905E-8f, -0.016849915f, 0.008948907f, -0.001772025f, 1.5255701E-4f,
                -6.3865664E-5f, -0.00155984f, 0.01654234f, -0.05829667f, 0.08751044f, -0.05829667f, 0.01654234f, -0.00155984f, -6.3865664E-5f,
                1.5255701E-4f, -0.001772025f, 0.008948907f, -0.016849915f, 4.241905E-8f, 0.03009234f, -0.028542273f, 0.010093632f, -0.0015519208f,
                3.4804232E-6f, 1.5181002E-4f, -0.002875261f, 0.018096048f, -0.048513148f, 0.05771689f, -0.02924932f, 0.0049256017f, 3.6016508E-4f,
                -4.608856E-6f, 9.560732E-5f, -8.622859E-4f, 0.0028996035f, -3.4763932E-8f, -0.01651633f, 0.02797731f, -0.01766952f, 0.0048518367f,
                -5.8290738E-8f, -4.540664E-6f, 1.5358784E-4f, -0.0017263265f, 0.008265292f, -0.017561484f, 0.01589402f, -0.0047801067f, -6.242116E-4f,
        });

        kernels.position(0);
        mcFilter = new MultiConvolutionFilter(kernels, kernelSize, kernelSize, numKernels);

        screen = new ScreenEndpoint(pipeline);
        input.addTarget(gFilter);
        gFilter.addTarget(mcFilter);
        mcFilter.addTarget(screen);
        pipeline.addRootRenderer(input);
        pipeline.startRendering();

        //set up auto focus on tap
        view.setOnTouchListener(new View.OnTouchListener() {
            public boolean onTouch(View v, MotionEvent e) {
                if(System.currentTimeMillis() - touchTime > 100) {
                    touchTime = System.currentTimeMillis();
                    ((CameraPreviewInput) input).autofocus();
                }
                return false;
            }
        });
    }

    @Override
    public void onPause() {
        super.onPause();
        ((CameraPreviewInput) input).onPause();
    }

    @Override
    public void onResume() {
        super.onResume();
        ((CameraPreviewInput) input).onResume();
    }
}
